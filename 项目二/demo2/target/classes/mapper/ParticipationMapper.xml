<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gzy.demo2.mapper.ParticipationMapper">
    
    <!-- 结果映射 -->
    <resultMap id="ParticipationResultMap" type="com.gzy.demo2.entity.Participation">
        <id property="id" column="id"/>
        <result property="studentNumber" column="student_number"/>
        <result property="activityNumber" column="activity_number"/>
        <result property="status" column="status"/>
        <result property="signUpTime" column="sign_up_time"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>
    
    <!-- 插入参与记录 -->
    <insert id="insertParticipation" parameterType="com.gzy.demo2.entity.Participation">
        INSERT INTO participation (student_number, activity_number, status, sign_up_time)
        VALUES (#{studentNumber}, #{activityNumber}, #{status}, #{signUpTime})
    </insert>
    
    <!-- 删除参与记录 -->
    <delete id="deleteParticipationById" parameterType="long">
        DELETE FROM participation WHERE id = #{id}
    </delete>
    
    <!-- 更新参与记录 -->
    <update id="updateParticipation" parameterType="com.gzy.demo2.entity.Participation">
        UPDATE participation
        SET student_number = #{studentNumber},
            activity_number = #{activityNumber},
            status = #{status},
            sign_up_time = #{signUpTime},
            update_time = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>
    
    <!-- 更新参与状态 -->
    <update id="updateParticipationStatus">
        UPDATE participation
        SET status = #{status},
            update_time = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>
    
    <!-- 根据ID查询参与记录 -->
    <select id="selectParticipationById" parameterType="long" resultMap="ParticipationResultMap">
        SELECT id, student_number, activity_number, status, sign_up_time, create_time, update_time
        FROM participation
        WHERE id = #{id}
    </select>
    
    <!-- 查询所有参与记录 -->
    <select id="selectAllParticipations" resultMap="ParticipationResultMap">
        SELECT id, student_number, activity_number, status, sign_up_time, create_time, update_time
        FROM participation
    </select>
    
    <!-- 根据学号查询参与记录 -->
    <select id="selectParticipationsByStudentNumber" parameterType="string" resultMap="ParticipationResultMap">
        SELECT id, student_number, activity_number, status, sign_up_time, create_time, update_time
        FROM participation
        WHERE student_number = #{studentNumber}
    </select>
    
    <!-- 根据活动编号查询参与记录 -->
    <select id="selectParticipationsByActivityNumber" parameterType="string" resultMap="ParticipationResultMap">
        SELECT id, student_number, activity_number, status, sign_up_time, create_time, update_time
        FROM participation
        WHERE activity_number = #{activityNumber}
    </select>
    
</mapper>