<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gzy.demo2.mapper.MemberMapper">
    
    <!-- 结果映射 -->
    <resultMap id="MemberResultMap" type="com.gzy.demo2.entity.Member">
        <id property="memberId" column="memberId"/>
        <result property="memberStudentId" column="memberStudentId"/>
        <result property="memberSocietyId" column="member_societyId"/>
        <result property="joinDate" column="joinDate"/>
        <result property="memberStatus" column="memberStatus"/>
        <result property="memberPosition" column="memberPosition"/>
        <!-- 学生相关字段映射 -->
        <result property="studentNumber" column="studentNumber"/>
        <result property="studentName" column="studentName"/>
        <result property="gender" column="gender"/>
        <result property="graduated" column="graduated"/>
    </resultMap>
    
    <!-- 插入会员信息 -->
    <insert id="insertMember" parameterType="com.gzy.demo2.entity.Member">
        INSERT INTO member (memberStudentId, member_societyId, joinDate, memberStatus, memberPosition)
        VALUES (#{memberStudentId}, #{memberSocietyId}, #{joinDate}, #{memberStatus}, #{memberPosition})
    </insert>
    
    <!-- 删除会员信息 -->
    <delete id="deleteMemberById" parameterType="java.lang.Integer">
        DELETE FROM member WHERE memberId = #{memberId}
    </delete>
    
    <!-- 更新会员信息 -->
    <update id="updateMember" parameterType="com.gzy.demo2.entity.Member">
        UPDATE member
        SET memberStudentId = #{memberStudentId},
            member_societyId = #{memberSocietyId},
            joinDate = #{joinDate},
            memberStatus = #{memberStatus},
            memberPosition = #{memberPosition}
        WHERE memberId = #{memberId}
    </update>
    
    <!-- 更新会员状态 -->
    <update id="updateMemberStatus">
        UPDATE member
        SET memberStatus = #{arg1}
        WHERE memberId = #{arg0}
    </update>
    
    <!-- 根据ID查询会员 -->
    <select id="selectMemberById" parameterType="java.lang.Integer" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.memberId = #{memberId}
    </select>
    
    <!-- 查询所有会员 -->
    <select id="selectAllMembers" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
    </select>
    
    <!-- 根据学生ID查询会员 -->
    <select id="selectMemberByStudentId" parameterType="int" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.memberStudentId = #{memberStudentId}
        LIMIT 1
    </select>
    
    <!-- 根据学生ID查询所有会员记录 -->
    <select id="selectMembersByStudentId" parameterType="int" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.memberStudentId = #{memberStudentId}
    </select>
    
    <!-- 根据社团ID查询会员 -->
    <select id="selectMembersBySocietyId" parameterType="int" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.member_societyId = #{memberSocietyId}
    </select>
    
    <!-- 根据状态查询会员 -->
    <select id="selectMembersByStatus" parameterType="int" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.memberStatus = #{memberStatus}
    </select>
    
    <!-- 根据社团ID和状态查询会员 -->
    <select id="selectMembersBySocietyIdAndStatus" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE m.member_societyId = #{arg0} AND m.memberStatus = #{arg1}
    </select>
    
    <!-- 根据关键词搜索会员 -->
    <select id="selectMembersByKeyword" parameterType="string" resultMap="MemberResultMap">
        SELECT m.memberId, m.memberStudentId, m.member_societyId, m.joinDate, m.memberStatus, m.memberPosition,
               s.studentNumber, s.studentName, s.gender, s.graduated
        FROM member m
        LEFT JOIN student s ON m.memberStudentId = s.studentId
        WHERE s.studentName LIKE CONCAT('%', #{keyword}, '%') OR s.studentNumber LIKE CONCAT('%', #{keyword}, '%')
    </select>
    
</mapper>